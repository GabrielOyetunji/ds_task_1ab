<!DOCTYPE html>
<html>
<head>
    <title>Text Query → Product Recommendation</title>
</head>

<body>
    <h2>Text Query → Product Recommendation</h2>

    <!-- Query Form -->
    <form id="form">
        <input type="text" id="query" placeholder="Enter your product search..." size="50" required>
        <button type="submit">Search</button>
    </form>

    <hr>

    <!-- Extracted Query -->
    <h3>Query</h3>
    <input id="show_query" type="text" style="width:90%; padding:8px;" readonly>

    <!-- Summary -->
    <h3>Summary</h3>
    <div id="summary" style="border:1px solid #ccc; padding:10px; width:90%;"></div>

    <!-- Recommended Products -->
    <h3>Recommended Products</h3>
    <table id="table" border="1" cellpadding="8" style="border-collapse: collapse; width:90%;">
        <thead>
            <tr>
                <th>Description</th>
                <th>Country</th>
                <th>Price</th>
                <th>Similarity Score</th>
                <th>Stock Code</th>
            </tr>
        </thead>
        <tbody id="table_body"></tbody>
    </table>

    <script>
        document.getElementById("form").onsubmit = async (e) => {
            e.preventDefault();

            let query = document.getElementById("query").value;

            let res = await fetch("/recommend", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ query: query })
            });

            let data = await res.json();

            // Fill "Query" box
            document.getElementById("show_query").value = data.query || "";

            // Fill Summary
            document.getElementById("summary").textContent = data.response || "";

            // Fill Table
            let tb = document.getElementById("table_body");
            tb.innerHTML = "";

            if (data.products && data.products.length > 0) {
                data.products.forEach(p => {
                    let row = `
                        <tr>
                            <td>${p.description}</td>
                            <td>${p.country}</td>
                            <td>£${p.price}</td>
                            <td>${p.similarity_score.toFixed(3)}</td>
                            <td>${p.stock_code}</td>
                        </tr>
                    `;
                    tb.innerHTML += row;
                });
            }
        };
    </script>

</body>
</html>